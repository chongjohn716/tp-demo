!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.JTopo=e():t.JTopo=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=function(t){return t};"click,mousedown,mouseup,mouseover,mouseout,mousedrag,keydown,keyup".split(",");var n=function(t){if("number"!=typeof t){for(var e=0;e<this.length;e++)if(this[e]===t)return this.slice(0,e).concat(this.slice(e+1,this.length));return this}return t<0?this:this.slice(0,t).concat(this.slice(t+1,this.length))};var o=function(t,e){t.prototype=new e,t.prototype.constructor=t,t.super=e.prototype},h=document.createElement("canvas"),r=h.getContext("2d"),l={};function u(t,e,i,s){var n,o;return null==i&&null==s?(n=e.x-t.x,o=e.y-t.y):(n=i-t,o=s-e),Math.sqrt(n*n+o*o)}function c(t){return(t=f(t)).pageX||(t.pageX=t.clientX+document.body.scrollLeft-document.body.clientLeft,t.pageY=t.clientY+document.body.scrollTop-document.body.clientTop),t}function d(t,e,i,s,n){var o=i-t,h=s-e,r=Math.sqrt(o*o+h*h),a=Math.atan2(h,o)+n;return{x:t+Math.cos(a)*r,y:e+Math.sin(a)*r}}function f(t){var e={};for(var i in t)"returnValue"!=i&&"keyLocation"!=i&&(e[i]=t[i]);return e}function p(t,e){for(var i="",s=0;s<e.length;s++){s>0&&(i+=",");var n=t[e[s]];"string"==typeof n?n='"'+n+'"':void 0==n&&(n=null),i+=e[s]+":"+n}return i}function g(t,e,i,s){function n(t){return t*o+h}var o=(s-e)/(i-t),h=e-t*o;return n.k=o,n.b=h,n.x1=t,n.x2=i,n.y1=e,n.y2=s,n}function v(t,e,i){var s=Math.abs(e-i),n=Math.abs(e-t),o=Math.abs(i-t);return Math.abs(s-(n+o))<1e-6}function y(t,e,i){return v(t,i.x1,i.x2)&&v(e,i.y1,i.y2)}function m(t,e){var i,s;return t.k==e.k?null:(1/0==t.k||t.k==-1/0?(i=t.x1,s=e(t.x1)):1/0==e.k||e.k==-1/0?(i=e.x1,s=t(e.x1)):s=t(i=(e.b-t.b)/(t.k-e.k)),0==y(i,s,t)?null:0==y(i,s,e)?null:{x:i,y:s})}var x={rotatePoint:d,rotatePoints:function(t,e,i){for(var s=[],n=0;n<e.length;n++){var o=d(t.x,t.y,e[n].x,e[n].y,i);s.push(o)}return s},getDistance:u,getEventPosition:function(t){return c(t)},mouseCoords:c,isFirefox:navigator.userAgent.indexOf("Firefox")>0,isIE:!(!window.attachEvent||-1!==navigator.userAgent.indexOf("Opera")),isChrome:null!=navigator.userAgent.toLowerCase().match(/chrome/),clone:function(t){var e={};for(var i in t)e[i]=t[i];return e},isPointInRect:function(t,e){var i=e.x,s=e.y,n=e.width,o=e.height;return t.x>i&&t.x<i+n&&t.y>s&&t.y<s+o},isPointInLine:function(t,e,i){var s=u(e,i),n=u(e,t),o=u(i,t);return Math.abs(n+o-s)<=.5},removeFromArray:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e){t=n.call(t,i);break}return t},cloneEvent:f,randomColor:function(){return Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())},isIntsect:function(){},toJson:function(t){var e="backgroundColor,visible,mode,rotate,alpha,scaleX,scaleY,shadow,translateX,translateY,areaSelect,paintAll".split(","),i="text,elementType,x,y,width,height,visible,alpha,rotate,scaleX,scaleY,fillColor,shadow,transformAble,zIndex,dragable,selected,showSelected,font,fontColor,textPosition,textOffsetX,textOffsetY".split(","),s="{";s+="frames:"+t.frames,s+=", scenes:[";for(var n=0;n<t.childs.length;n++){var o=t.childs[n];s+="{",s+=p(o,e),s+=", elements:[";for(var h=0;h<o.childs.length;h++){var r=o.childs[h];h>0&&(s+=","),s+="{",s+=p(r,i),s+="}"}s+="]}"}return(s+="]")+"}"},getElementsBound:function(t){for(var e={left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE},i=0;i<t.length;i++){var s=t[i];s instanceof JTopo.Link||(e.left>s.x&&(e.left=s.x,e.leftNode=s),e.right<s.x+s.width&&(e.right=s.x+s.width,e.rightNode=s),e.top>s.y&&(e.top=s.y,e.topNode=s),e.bottom<s.y+s.height&&(e.bottom=s.y+s.height,e.bottomNode=s))}return e.width=e.right-e.left,e.height=e.bottom-e.top,e},genImageAlarm:function(t,e){var i=t.src+e;if(l[i])return l[i];var s=new Image;return s.src=function(t,e,i){var s=i.split(","),n=parseInt(s[0]),o=parseInt(s[1]),r=parseInt(s[2]),a=h.width=e.width,l=h.height=e.height;t.clearRect(0,0,h.width,h.height),t.drawImage(e,0,0);for(var u=t.getImageData(0,0,e.width,e.height),c=u.data,d=0;a>d;d++)for(var f=0;l>f;f++){var p=4*(d+f*a);0!=c[p+3]&&(null!=n&&(c[p+0]+=n),null!=o&&(c[p+1]+=o),null!=r&&(c[p+2]+=r))}return t.putImageData(u,0,0,0,0,e.width,e.height),h.toDataURL()}(r,t,e),l[i]=s,s},getOffsetPosition:function(t){if(!t)return{left:0,top:0};var e=0,i=0;if("getBoundingClientRect"in document.documentElement){var s=t.getBoundingClientRect(),n=t.ownerDocument,o=n.body,h=n.documentElement,r=h.clientTop||o.clientTop||0,a=h.clientLeft||o.clientLeft||0;e=s.top+(self.pageYOffset||h&&h.scrollTop||o.scrollTop)-r,i=s.left+(self.pageXOffset||h&&h.scrollLeft||o.scrollLeft)-a}else do{e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.offsetParent}while(t);return{left:i,top:e}},lineF:g,intersection:m,intersectionLineBound:function(t,e){var i=g(e.left,e.top,e.left,e.bottom),s=m(t,i);return null==s&&null==(s=m(t,i=g(e.left,e.top,e.right,e.top)))&&null==(s=m(t,i=g(e.right,e.top,e.right,e.bottom)))&&(s=m(t,i=g(e.left,e.bottom,e.right,e.bottom))),s},loadStageFromJson:function(t,e){var i=new JTopo.Stage(e);for(var s in t)if("scenes"!=s)i[s]=obj[s];else for(var n=obj.scenes,o=0;o<n.length;o++){var h=n[o],r=new JTopo.Scene(i);for(var a in h)if("elements"!=a)r[a]=h[a];else for(var l={},u=h.elements,c=0;c<u.length;c++){var d,f=u[c],p=f.elementType;for(var g in"Node"==p&&(d=new JTopo.Node),f)d[g]=f[g];l[d.text]=d,r.add(d)}}return console.log(i),i}};function w(t){this.name=t,this.messageMap={},this.messageCount=0}w.prototype.subscribe=function(t,e){null==this.messageMap[t]&&(this.messageMap[t]=[]),this.messageMap[t].push(e),this.messageCount++},w.prototype.unsubscribe=function(t){null!=this.messageMap[t]&&(this.messageMap[t]=null,delete this.messageMap[t],this.messageCount--)},w.prototype.publish=function(t,e,i){var s=this.messageMap[t];if(null!=s)for(var n=0;n<s.length;n++)i?function(t,e){setTimeout(function(){t(e)},10)}(s[n],e):s[n](e)};var E=w,T="normal",P="drag",S="edit",M="select",k="default",I="url(./img/cur/openhand.cur) 8 8, default",L="url(./img/cur/closedhand.cur) 8 8, default",A=1,C=2,z=3,X=-(Math.PI/2+Math.PI/4);function B(t){var e=this;null!=t&&this.initialize(t);var i=this;"click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,touchstart,touchmove,touchend,keydown,keyup".split(",").forEach(function(t){i[t]=function(e){null!=e?this.addEventListener(t,e):this.dispatchEvent(t)}}),function t(){0==e.frames?setTimeout(t,100):e.frames<0?(e.repaint(),setTimeout(t,1e3/-e.frames)):(e.repaint(),setTimeout(t,1e3/e.frames))}(),setTimeout(function(){e.mousewheel(function(t){var e=null==t.wheelDelta?t.detail:t.wheelDelta;null!=this.wheelZoom&&(e>0?this.zoomIn(this.wheelZoom):this.zoomOut(this.wheelZoom))}),e.paint()},300),setTimeout(function(){e.paint()},1e3),setTimeout(function(){e.paint()},3e3)}B.prototype.initialize=function(t){this.bindEvent(t),this.canvas=t,this.graphics=t.getContext("2d"),this.childs=[],this.frames=24,this.messageBus=new E,this.eagleEye=function(t){return{hgap:16,visible:!1,exportCanvas:document.createElement("canvas"),getImage:function(e,i){var s=t.getBound(),n=1,o=1;this.exportCanvas.width=t.canvas.width,this.exportCanvas.height=t.canvas.height,null!=e&&null!=i?(this.exportCanvas.width=e,this.exportCanvas.height=i,n=e/s.width,o=i/s.height):(s.width>t.canvas.width&&(this.exportCanvas.width=s.width),s.height>t.canvas.height&&(this.exportCanvas.height=s.height));var h=this.exportCanvas.getContext("2d");return t.childs.length>0&&(h.save(),h.clearRect(0,0,this.exportCanvas.width,this.exportCanvas.height),t.childs.forEach(function(t){1==t.visible&&(t.save(),t.translateX=0,t.translateY=0,t.scaleX=1,t.scaleY=1,h.scale(n,o),s.left<0&&(t.translateX=Math.abs(s.left)),s.top<0&&(t.translateY=Math.abs(s.top)),t.paintAll=!0,t.repaint(h),t.paintAll=!1,t.restore())}),h.restore()),this.exportCanvas.toDataURL("image/png")},canvas:document.createElement("canvas"),update:function(){this.eagleImageDatas=this.getData(t)},setSize:function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},getData:function(e,i){null!=a&&null!=l?this.setSize(e,i):this.setSize(200,160);var s=this.canvas.getContext("2d");if(t.childs.length>0){s.save(),s.clearRect(0,0,this.canvas.width,this.canvas.height),t.childs.forEach(function(t){1==t.visible&&(t.save(),t.centerAndZoom(null,null,s),t.repaint(s),t.restore())});var n=function(t){var e=t.stage.canvas.width,i=t.stage.canvas.height,s=e/t.scaleX/2,n=i/t.scaleY/2;return{translateX:t.translateX+s-s*t.scaleX,translateY:t.translateY+n-n*t.scaleY}}(t.childs[0]),o=n.translateX*(this.canvas.width/t.canvas.width)*t.childs[0].scaleX,h=n.translateY*(this.canvas.height/t.canvas.height)*t.childs[0].scaleY,r=t.getBound(),a=t.canvas.width/t.childs[0].scaleX/r.width,l=t.canvas.height/t.childs[0].scaleY/r.height;a>1&&(a=1),l>1&&(a=1),o*=a,h*=l,r.left<0&&(o-=Math.abs(r.left)*(this.width/r.width)),r.top<0&&(h-=Math.abs(r.top)*(this.height/r.height)),s.save(),s.lineWidth=1,s.strokeStyle="rgba(255,0,0,1)",s.strokeRect(-o,-h,s.canvas.width*a,s.canvas.height*l),s.restore();var u=null;try{u=s.getImageData(0,0,s.canvas.width,s.canvas.height)}catch(t){}return u}return null},paint:function(){if(null!=this.eagleImageDatas){var e=t.graphics;e.save(),e.fillStyle="rgba(211,211,211,0.3)",e.fillRect(t.canvas.width-this.canvas.width-2*this.hgap,t.canvas.height-this.canvas.height-1,t.canvas.width-this.canvas.width,this.canvas.height+1),e.fill(),e.save(),e.lineWidth=1,e.strokeStyle="rgba(0,0,0,1)",e.rect(t.canvas.width-this.canvas.width-2*this.hgap,t.canvas.height-this.canvas.height-1,t.canvas.width-this.canvas.width,this.canvas.height+1),e.stroke(),e.restore(),e.putImageData(this.eagleImageDatas,t.canvas.width-this.canvas.width-this.hgap,t.canvas.height-this.canvas.height),e.restore()}else this.eagleImageDatas=this.getData(t)},eventHandler:function(t,e,i){var s=e.x,n=e.y;if(s>i.canvas.width-this.canvas.width&&n>i.canvas.height-this.canvas.height&&(s=e.x-this.canvas.width,n=e.y-this.canvas.height,"mousedown"==t&&(this.lastTranslateX=i.childs[0].translateX,this.lastTranslateY=i.childs[0].translateY),"mousedrag"==t&&i.childs.length>0)){var o=e.dx,h=e.dy,r=i.getBound(),a=this.canvas.width/i.childs[0].scaleX/r.width,l=this.canvas.height/i.childs[0].scaleY/r.height;i.childs[0].translateX=this.lastTranslateX-o/a,i.childs[0].translateY=this.lastTranslateY-h/l}}}}(this),this.wheelZoom=null,this.mouseDownX=0,this.mouseDownY=0,this.mouseDown=!1,this.mouseOver=!1,this.needRepaint=!0,this.serializedProperties=["frames","wheelZoom"]},B.prototype.bindEvent=function(t){var e=this,i=!0,s=null;function n(t){var i=x.getEventPosition(t),s=x.getOffsetPosition(e.canvas);return i.offsetLeft=i.pageX-s.left,i.offsetTop=i.pageY-s.top,i.x=i.offsetLeft,i.y=i.offsetTop,i.target=null,i}function o(t){document.onselectstart=function(){return!1},this.mouseOver=!0;var i=n(t);e.dispatchEventToScenes("mouseover",i),e.dispatchEvent("mouseover",i)}function h(t){s=setTimeout(function(){i=!0},500),document.onselectstart=function(){return!0};var o=n(t);e.dispatchEventToScenes("mouseout",o),e.dispatchEvent("mouseout",o),e.needRepaint=0!=e.animate}function r(t){var i=n(t);e.mouseDown=!0,e.mouseDownX=i.x,e.mouseDownY=i.y,e.dispatchEventToScenes("mousedown",i),e.dispatchEvent("mousedown",i)}function a(t){var i=n(t);e.dispatchEventToScenes("mouseup",i),e.dispatchEvent("mouseup",i),e.mouseDown=!1,e.needRepaint=0!=e.animate}function l(t){s&&(window.clearTimeout(s),s=null),i=!1;var o=n(t);e.mouseDown?0==t.button&&(o.dx=o.x-e.mouseDownX,o.dy=o.y-e.mouseDownY,e.dispatchEventToScenes("mousedrag",o),e.dispatchEvent("mousedrag",o),1==e.eagleEye.visible&&e.eagleEye.update()):(e.dispatchEventToScenes("mousemove",o),e.dispatchEvent("mousemove",o))}function u(t){var i=n(t);e.dispatchEventToScenes("click",i),e.dispatchEvent("click",i)}function c(t){var i=n(t);e.dispatchEventToScenes("dbclick",i),e.dispatchEvent("dbclick",i)}function d(t){var i=n(t);e.dispatchEventToScenes("mousewheel",i),e.dispatchEvent("mousewheel",i),null!=e.wheelZoom&&(t.preventDefault?t.preventDefault():(t=t||window.event).returnValue=!1,1==e.eagleEye.visible&&e.eagleEye.update())}document.oncontextmenu=function(){return i},function(t){x.isIE||!window.addEventListener?(t.onmouseout=h,t.onmouseover=o,t.onmousedown=r,t.onmouseup=a,t.onmousemove=l,t.onclick=u,t.ondblclick=c,t.onmousewheel=d,t.touchstart=r,t.touchmove=l,t.touchend=a):(t.addEventListener("mouseout",h),t.addEventListener("mouseover",o),t.addEventListener("mousedown",r),t.addEventListener("mouseup",a),t.addEventListener("mousemove",l),t.addEventListener("click",u),t.addEventListener("dblclick",c),x.isFirefox?t.addEventListener("DOMMouseScroll",d):t.addEventListener("mousewheel",d)),window.addEventListener&&(window.addEventListener("keydown",function(t){e.dispatchEventToScenes("keydown",x.cloneEvent(t));var i=t.keyCode;(37==i||38==i||39==i||40==i)&&(t.preventDefault?t.preventDefault():(t=t||window.event).returnValue=!1)},!0),window.addEventListener("keyup",function(t){e.dispatchEventToScenes("keyup",x.cloneEvent(t));var i=t.keyCode;(37==i||38==i||39==i||40==i)&&(t.preventDefault?t.preventDefault():(t=t||window.event).returnValue=!1)},!0))}(t)},B.prototype.dispatchEventToScenes=function(t,e){if(0!=this.frames&&(this.needRepaint=!0),1==this.eagleEye.visible&&-1!=t.indexOf("mouse")){var i=e.x,s=e.y;if(i>this.width-this.eagleEye.width&&s>this.height-this.eagleEye.height)return void this.eagleEye.eventHandler(t,e,this)}this.childs.forEach(function(i){if(1==i.visible){var s=i[t+"Handler"];if(null==s)throw new Error("Function not found:"+t+"Handler");s.call(i,e)}})},B.prototype.add=function(t){for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t)return;t.addTo(this),this.childs.push(t)},B.prototype.remove=function(t){if(null==t)throw new Error("Stage.remove出错: 参数为null!");for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t)return t.stage=null,this.childs=n.call(this.childs,e),this;return this},B.prototype.clear=function(){this.childs=[]},B.prototype.addEventListener=function(t,e){var i=this;return this.messageBus.subscribe(t,function(t){e.call(i,t)}),this},B.prototype.removeEventListener=function(t){this.messageBus.unsubscribe(t)},B.prototype.removeAllEventListener=function(){this.messageBus=new E},B.prototype.dispatchEvent=function(t,e){return this.messageBus.publish(t,e),this},B.prototype.saveImageInfo=function(t,e){var i=this.eagleEye.getImage(t,e);return window.open("about:blank").document.write("<img src='"+i+"' alt='from canvas'/>"),this},B.prototype.saveAsLocalImage=function(t,e){var i=this.eagleEye.getImage(t,e);return i.replace("image/png","image/octet-stream"),window.location.href=i,this},B.prototype.paint=function(){if(this.canvas){var t=this.graphics;t.save(),t.clearRect(0,0,this.width,this.height),this.childs.forEach(function(e){1==e.visible&&e.repaint(t)}),1==this.eagleEye.visible&&this.eagleEye.paint(this),t.restore()}},B.prototype.repaint=function(){0!=this.frames&&(this.frames<0&&0==this.needRepaint||(this.paint(),this.frames<0&&(this.needRepaint=!1)))},B.prototype.zoom=function(t){this.childs.forEach(function(e){0!=e.visible&&e.zoom(t)})},B.prototype.zoomOut=function(t){this.childs.forEach(function(e){0!=e.visible&&e.zoomOut(t)})},B.prototype.zoomIn=function(t){this.childs.forEach(function(e){0!=e.visible&&e.zoomIn(t)})},B.prototype.centerAndZoom=function(){this.childs.forEach(function(t){0!=t.visible&&t.centerAndZoom()})},B.prototype.setCenter=function(t,e){var i=this;this.childs.forEach(function(s){var n=t-i.canvas.width/2,o=e-i.canvas.height/2;s.translateX=-n,s.translateY=-o})},B.prototype.getBound=function(){var t={left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE};return this.childs.forEach(function(e){var i=e.getElementsBound();i.left<t.left&&(t.left=i.left,t.leftNode=i.leftNode),i.top<t.top&&(t.top=i.top,t.topNode=i.topNode),i.right>t.right&&(t.right=i.right,t.rightNode=i.rightNode),i.bottom>t.bottom&&(t.bottom=i.bottom,t.bottomNode=i.bottomNode)}),t.width=t.right-t.left,t.height=t.bottom-t.top,t},B.prototype.toJson=function(){var t=this,e='{"version":"0.0.1",';return this.serializedProperties.length,this.serializedProperties.forEach(function(i){var s=t[i];"string"==typeof s&&(s='"'+s+'"'),e+='"'+i+'":'+s+","}),e+='"childs":[',this.childs.forEach(function(t){e+=t.toJson()}),e+="]",e+="}"},Object.defineProperties(B.prototype,{width:{get:function(){return this.canvas.width}},height:{get:function(){return this.canvas.height}},cursor:{set:function(t){this.canvas.style.cursor=t},get:function(){return this.canvas.style.cursor}},mode:{set:function(t){this.childs.forEach(function(e){e.mode=t})}}});var Y=B;function O(){}O.prototype.initialize=function(){this.elementType="element",this.serializedProperties=["elementType"],this.propertiesStack=[],this._id=""+(new Date).getTime()},O.prototype.distroy=s,O.prototype.removeHandler=s,O.prototype.attr=function(t,e){if(null!=t&&null!=e)this[t]=e;else if(null!=t)return this[t];return this},O.prototype.save=function(){var t=this,e={};this.serializedProperties.forEach(function(i){e[i]=t[i]}),this.propertiesStack.push(e)},O.prototype.restore=function(){if(null!=this.propertiesStack&&0!=this.propertiesStack.length){var t=this,e=this.propertiesStack.pop();this.serializedProperties.forEach(function(i){t[i]=e[i]})}},O.prototype.toJson=function(){var t=this,e="{",i=this.serializedProperties.length;return this.serializedProperties.forEach(function(s,n){var o=t[s];"string"==typeof o&&(o='"'+o+'"'),e+='"'+s+'":'+o,i>n+1&&(e+=",")}),e+="}"};var _=O;function D(){this.initialize()}function R(){this.initialize();var t=this;"click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,touchstart,touchmove,touchend".split(",").forEach(function(e){t[e]=function(t){null!=t?this.addEventListener(e,t):this.dispatchEvent(e)}})}o(D,_),Object.defineProperties(D.prototype,{cx:{get:function(){return this.x+this.width/2},set:function(t){this.x=t-this.width/2}},cy:{get:function(){return this.y+this.height/2},set:function(t){this.y=t-this.height/2}}}),D.prototype.initialize=function(){D.super.initialize.apply(this,arguments),this.elementType="displayElement",this.x=0,this.y=0,this.width=32,this.height=32,this.visible=!0,this.alpha=1,this.rotate=0,this.scaleX=1,this.scaleY=1,this.strokeColor="22,124,255",this.borderColor="22,124,255",this.fillColor="22,124,255",this.shadow=!1,this.shadowBlur=5,this.shadowColor="rgba(0,0,0,0.5)",this.shadowOffsetX=3,this.shadowOffsetY=6,this.transformAble=!1,this.zIndex=0;var t="x,y,width,height,visible,alpha,rotate,scaleX,scaleY,strokeColor,fillColor,shadow,shadowColor,shadowOffsetX,shadowOffsetY,transformAble,zIndex".split(",");this.serializedProperties=this.serializedProperties.concat(t)},D.prototype.paint=function(t){t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",t.rect(-this.width/2,-this.height/2,this.width,this.height),t.fill(),t.stroke(),t.closePath()},D.prototype.getLocation=function(){return{x:this.x,y:this.y}},D.prototype.setLocation=function(t,e){return this.x=t,this.y=e,this},D.prototype.getCenterLocation=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},D.prototype.setCenterLocation=function(t,e){return this.x=t-this.width/2,this.y=e-this.height/2,this},D.prototype.getSize=function(){return{width:this.width,height:this.heith}},D.prototype.setSize=function(t,e){return this.width=t,this.height=e,this},D.prototype.getBound=function(){return{left:this.x,top:this.y,right:this.x+this.width,bottom:this.y+this.height,width:this.width,height:this.height}},D.prototype.setBound=function(t,e,i,s){return this.setLocation(t,e),this.setSize(i,s),this},D.prototype.getDisplayBound=function(){return{left:this.x,top:this.y,right:this.x+this.width*this.scaleX,bottom:this.y+this.height*this.scaleY}},D.prototype.getDisplaySize=function(){return{width:this.width*this.scaleX,height:this.height*this.scaleY}},D.prototype.getPosition=function(t){var e,i=this.getBound();return"Top_Left"==t?e={x:i.left,y:i.top}:"Top_Center"==t?e={x:this.cx,y:i.top}:"Top_Right"==t?e={x:i.right,y:i.top}:"Middle_Left"==t?e={x:i.left,y:this.cy}:"Middle_Center"==t?e={x:this.cx,y:this.cy}:"Middle_Right"==t?e={x:i.right,y:this.cy}:"Bottom_Left"==t?e={x:i.left,y:i.bottom}:"Bottom_Center"==t?e={x:this.cx,y:i.bottom}:"Bottom_Right"==t&&(e={x:i.right,y:i.bottom}),e},o(R,D),R.prototype.initialize=function(){R.super.initialize.apply(this,arguments),this.elementType="interactiveElement",this.dragable=!1,this.selected=!1,this.showSelected=!0,this.selectedLocation=null,this.isMouseOver=!1;var t="dragable,selected,showSelected,isMouseOver".split(",");this.serializedProperties=this.serializedProperties.concat(t)},R.prototype.paintSelected=function(t){0!=this.showSelected&&(t.save(),t.beginPath(),t.strokeStyle="rgba(168,202,255, 0.9)",t.fillStyle="rgba(168,202,236,0.7)",t.rect(-this.width/2-3,-this.height/2-3,this.width+6,this.height+6),t.fill(),t.stroke(),t.closePath(),t.restore())},R.prototype.paintMouseover=function(t){return this.paintSelected(t)},R.prototype.isInBound=function(t,e){return t>this.x&&t<this.x+this.width*Math.abs(this.scaleX)&&e>this.y&&e<this.y+this.height*Math.abs(this.scaleY)},R.prototype.selectedHandler=function(){this.selected=!0,this.selectedLocation={x:this.x,y:this.y}},R.prototype.unselectedHandler=function(){this.selected=!1,this.selectedLocation=null},R.prototype.dbclickHandler=function(t){this.dispatchEvent("dbclick",t)},R.prototype.clickHandler=function(t){this.dispatchEvent("click",t)},R.prototype.mousedownHander=function(t){this.dispatchEvent("mousedown",t)},R.prototype.mouseupHandler=function(t){this.dispatchEvent("mouseup",t)},R.prototype.mouseoverHandler=function(t){this.isMouseOver=!0,this.dispatchEvent("mouseover",t)},R.prototype.mousemoveHandler=function(t){this.dispatchEvent("mousemove",t)},R.prototype.mouseoutHandler=function(t){this.isMouseOver=!1,this.dispatchEvent("mouseout",t)},R.prototype.mousedragHandler=function(t){var e=this.selectedLocation.x+t.dx,i=this.selectedLocation.y+t.dy;this.setLocation(e,i),this.dispatchEvent("mousedrag",t)},R.prototype.addEventListener=function(t,e){var i=this;return this.messageBus||(this.messageBus=new E),this.messageBus.subscribe(t,function(t){e.call(i,t)}),this},R.prototype.dispatchEvent=function(t,e){return this.messageBus?(this.messageBus.publish(t,e),this):null},R.prototype.removeEventListener=function(t){this.messageBus.unsubscribe(t)},R.prototype.removeAllEventListener=function(){this.messageBus=new E};var Z=R;function F(){}o(F,Z),F.prototype.initialize=function(){F.super.initialize.apply(this,arguments),this.editAble=!1,this.selectedPoint=null},F.prototype.getCtrlPosition=function(t){var e=this.getPosition(t);return{left:e.x-5,top:e.y-5,right:e.x+5,bottom:e.y+5}},F.prototype.selectedHandler=function(t){F.super.selectedHandler.apply(this,arguments),this.selectedSize={width:this.width,height:this.height},t.scene.mode===S&&(this.editAble=!0)},F.prototype.unselectedHandler=function(){F.super.unselectedHandler.apply(this,arguments),this.selectedSize=null,this.editAble=!1};var N=["Top_Left","Top_Center","Top_Right","Middle_Left","Middle_Right","Bottom_Left","Bottom_Center","Bottom_Right"];F.prototype.paintCtrl=function(t){if(this.editAble){t.save();for(var e=0;e<N.length;e++){var i=this.getCtrlPosition(N[e]);i.left-=this.cx,i.right-=this.cx,i.top-=this.cy,i.bottom-=this.cy;var s=i.right-i.left,n=i.bottom-i.top;t.beginPath(),t.strokeStyle="rgba(0,0,0,0.8)",t.rect(i.left,i.top,s,n),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba(255,255,255,0.3)",t.rect(i.left+1,i.top+1,s-2,n-2),t.stroke(),t.closePath()}t.restore()}},F.prototype.isInBound=function(t,e){if(this.selectedPoint=null,this.editAble)for(var i=0;i<N.length;i++){var s=this.getCtrlPosition(N[i]);if(t>s.left&&t<s.right&&e>s.top&&e<s.bottom)return this.selectedPoint=N[i],!0}return F.super.isInBound.apply(this,arguments)},F.prototype.mousedragHandler=function(t){var e,i,s,n;null==this.selectedPoint?(e=this.selectedLocation.x+t.dx,i=this.selectedLocation.y+t.dy,this.setLocation(e,i),this.dispatchEvent("mousedrag",t)):("Top_Left"===this.selectedPoint?(s=this.selectedSize.width-t.dx,n=this.selectedSize.height-t.dy,e=this.selectedLocation.x+t.dx,i=this.selectedLocation.y+t.dy,e<this.x+this.width&&(this.x=e,this.width=s),i<this.y+this.height&&(this.y=i,this.height=n)):"Top_Center"===this.selectedPoint?(n=this.selectedSize.height-t.dy,(i=this.selectedLocation.y+t.dy)<this.y+this.height&&(this.y=i,this.height=n)):"Top_Right"===this.selectedPoint?(s=this.selectedSize.width+t.dx,(i=this.selectedLocation.y+t.dy)<this.y+this.height&&(this.y=i,this.height=this.selectedSize.height-t.dy),s>1&&(this.width=s)):"Middle_Left"===this.selectedPoint?(s=this.selectedSize.width-t.dx,(e=this.selectedLocation.x+t.dx)<this.x+this.width&&(this.x=e),s>1&&(this.width=s)):"Middle_Right"===this.selectedPoint?(s=this.selectedSize.width+t.dx)>1&&(this.width=s):"Bottom_Left"===this.selectedPoint?(s=this.selectedSize.width-t.dx,e=this.selectedLocation.x+t.dx,s>1&&(this.x=e,this.width=s),(n=this.selectedSize.height+t.dy)>1&&(this.height=n)):"Bottom_Center"===this.selectedPoint?(n=this.selectedSize.height+t.dy)>1&&(this.height=n):"Bottom_Right"===this.selectedPoint&&((s=this.selectedSize.width+t.dx)>1&&(this.width=s),(n=this.selectedSize.height+t.dy)>1&&(this.height=n)),this.dispatchEvent("resize",t))};var H={};function J(t){this.initialize(t)}o(J,F),Object.defineProperties(J.prototype,{alarmColor:{get:function(){return this._alarmColor},set:function(t){if(this._alarmColor=t,null!=this.image){var e=JTopo.util.genImageAlarm(this.image,t);e&&(this.alarmImage=e)}}}}),J.prototype.initialize=function(t){J.super.initialize.apply(this,arguments),this.elementType="node",this.zIndex=z,this.text=t,this.font="12px Consolas",this.fontColor="255,255,255",this.borderWidth=0,this.borderColor="255,255,255",this.borderRadius=null,this.dragable=!0,this.textPosition="Bottom_Center",this.textOffsetX=0,this.textOffsetY=0,this.transformAble=!0,this.inLinks=null,this.outLinks=null;var e="text,font,fontColor,textPosition,textOffsetX,textOffsetY,borderRadius".split(",");this.serializedProperties=this.serializedProperties.concat(e)},J.prototype.paint=function(t){if(this.image){var e=t.globalAlpha;t.globalAlpha=this.alpha,null!=this.alarmImage&&null!=this.alarm?t.drawImage(this.alarmImage,-this.width/2,-this.height/2,this.width,this.height):t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),t.globalAlpha=e}else t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",null==this.borderRadius||0==this.borderRadius?t.rect(-this.width/2,-this.height/2,this.width,this.height):t.JTopoRoundRect(-this.width/2,-this.height/2,this.width,this.height,this.borderRadius),t.fill(),t.closePath();this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},J.prototype.paintAlarmText=function(t){if(null!=this.alarm&&""!=this.alarm){var e=this.alarmColor||"255,0,0",i=this.alarmAlpha||.5;t.beginPath(),t.font=this.alarmFont||"10px 微软雅黑";var s=t.measureText(this.alarm).width+6,n=t.measureText("田").width+6,o=this.width/2-s/2,h=-this.height/2-n-8;t.strokeStyle="rgba("+e+", "+i+")",t.fillStyle="rgba("+e+", "+i+")",t.lineCap="round",t.lineWidth=1,t.moveTo(o,h),t.lineTo(o+s,h),t.lineTo(o+s,h+n),t.lineTo(o+s/2+6,h+n),t.lineTo(o+s/2,h+n+8),t.lineTo(o+s/2-6,h+n),t.lineTo(o,h+n),t.lineTo(o,h),t.fill(),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.alarm,o+2,h+n-4),t.closePath()}},J.prototype.paintText=function(t){var e=this.text;if(null!=e&&""!=e){t.beginPath(),t.font=this.font;var i=t.measureText(e).width,s=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")";var n=this.getTextPostion(this.textPosition,i,s);t.fillText(e,n.x,n.y),t.closePath()}},J.prototype.paintBorder=function(t){if(0!=this.borderWidth){t.beginPath(),t.lineWidth=this.borderWidth,t.strokeStyle="rgba("+this.borderColor+","+this.alpha+")";var e=this.borderWidth/2;null==this.borderRadius||0==this.borderRadius?t.rect(-this.width/2-e,-this.height/2-e,this.width+this.borderWidth,this.height+this.borderWidth):t.JTopoRoundRect(-this.width/2-e,-this.height/2-e,this.width+this.borderWidth,this.height+this.borderWidth,this.borderRadius),t.stroke(),t.closePath()}},J.prototype.getTextPostion=function(t,e,i){var s=null;return null==t||"Bottom_Center"==t?s={x:-this.width/2+(this.width-e)/2,y:this.height/2+i}:"Top_Center"==t?s={x:-this.width/2+(this.width-e)/2,y:-this.height/2-i/2}:"Top_Right"==t?s={x:this.width/2,y:-this.height/2-i/2}:"Top_Left"==t?s={x:-this.width/2-e,y:-this.height/2-i/2}:"Bottom_Right"==t?s={x:this.width/2,y:this.height/2+i}:"Bottom_Left"==t?s={x:-this.width/2-e,y:this.height/2+i}:"Middle_Center"==t?s={x:-this.width/2+(this.width-e)/2,y:i/2}:"Middle_Right"==t?s={x:this.width/2,y:i/2}:"Middle_Left"==t&&(s={x:-this.width/2-e,y:i/2}),null!=this.textOffsetX&&(s.x+=this.textOffsetX),null!=this.textOffsetY&&(s.y+=this.textOffsetY),s},J.prototype.setImage=function(t,e){if(null==t)throw new Error("Node.setImage(): 参数Image对象为空!");var i=this;if("string"==typeof t){var s=H[t];null==s?((s=new Image).src=t,s.onload=function(){H[t]=s,1==e&&i.setSize(s.width,s.height),i.image=s,i.alarmColor=null==i.alarmColor?"255,0,0":i.alarmColor}):(e&&this.setSize(s.width,s.height),i.image=s,i.alarmColor=null==i.alarmColor?"255,0,0":i.alarmColor)}else this.image=t,i.alarmColor=null==i.alarmColor?"255,0,0":i.alarmColor,1==e&&this.setSize(t.width,t.height)},J.prototype.removeHandler=function(t){var e=this;this.outLinks&&(this.outLinks.forEach(function(i){i.nodeA===e&&t.remove(i)}),this.outLinks=null),this.inLinks&&(this.inLinks.forEach(function(i){i.nodeZ===e&&t.remove(i)}),this.inLinks=null)};var V=J;function W(t,e){var i=[];if(null==t||null==e)return i;if(t&&e&&t.outLinks&&e.inLinks)for(var s=0;s<t.outLinks.length;s++)for(var n=t.outLinks[s],o=0;o<e.inLinks.length;o++){var h=e.inLinks[o];n===h&&i.push(h)}return i}function j(t,e){var i=W(t,e),s=W(e,t);return i.concat(s)}function G(t,e){return j(t,e).length}function U(t,e,i){this.initialize(t,e,i)}o(U,Z),U.prototype.initialize=function(t,e,i){if(arguments.length<2)throw new Error("");U.super.initialize.apply(this,arguments),this.elementType="link",this.zIndex=C,this.text=i,this.nodeA=t,this.nodeZ=e,this.nodeA&&null==this.nodeA.outLinks&&(this.nodeA.outLinks=[]),this.nodeA&&null==this.nodeA.inLinks&&(this.nodeA.inLinks=[]),this.nodeZ&&null==this.nodeZ.inLinks&&(this.nodeZ.inLinks=[]),this.nodeZ&&null==this.nodeZ.outLinks&&(this.nodeZ.outLinks=[]),null!=this.nodeA&&this.nodeA.outLinks.push(this),null!=this.nodeZ&&this.nodeZ.inLinks.push(this),this.caculateIndex(),this.font="12px Consolas",this.fontColor="255,255,255",this.lineWidth=2,this.lineJoin="miter",this.transformAble=!1,this.bundleOffset=20,this.bundleGap=12,this.textOffsetX=0,this.textOffsetY=0,this.arrowsRadius=null,this.arrowsOffset=0,this.dashedPattern=null,this.path=[];var s="text,font,fontColor,lineWidth,lineJoin".split(",");this.serializedProperties=this.serializedProperties.concat(s)},U.prototype.caculateIndex=function(){var t=G(this.nodeA,this.nodeZ);t>0&&(this.nodeIndex=t-1)},U.prototype.removeHandler=function(){var t=this;this.nodeA&&this.nodeA.outLinks&&(this.nodeA.outLinks=this.nodeA.outLinks.filter(function(e){return e!==t})),this.nodeZ&&this.nodeZ.inLinks&&(this.nodeZ.inLinks=this.nodeZ.inLinks.filter(function(e){return e!==t})),function(t){var e=j(t.nodeA,t.nodeZ);return e.filter(function(e){return t!==e})}(this).forEach(function(t,e){t.nodeIndex=e})},U.prototype.getStartPosition=function(){return{x:this.nodeA.cx,y:this.nodeA.cy}},U.prototype.getEndPosition=function(){var t;return null!=this.arrowsRadius&&(t=function(t,e){var i=x.lineF(t.cx,t.cy,e.cx,e.cy),s=t.getBound();return x.intersectionLineBound(i,s)}(this.nodeZ,this.nodeA)),null==t&&(t={x:this.nodeZ.cx,y:this.nodeZ.cy}),t},U.prototype.getPath=function(){var t=[],e=this.getStartPosition(),i=this.getEndPosition();if(this.nodeA===this.nodeZ)return[e,i];var s=G(this.nodeA,this.nodeZ);if(1==s)return[e,i];var n=Math.atan2(i.y-e.y,i.x-e.x),o=e.x+this.bundleOffset*Math.cos(n),h=e.y+this.bundleOffset*Math.sin(n),r=i.x+this.bundleOffset*Math.cos(n-Math.PI),a=i.y+this.bundleOffset*Math.sin(n-Math.PI),l=n-Math.PI/2,u=n-Math.PI/2,c=s*this.bundleGap/2-this.bundleGap/2,d=this.bundleGap*this.nodeIndex,f={x:o+d*Math.cos(l),y:h+d*Math.sin(l)},p={x:r+d*Math.cos(u),y:a+d*Math.sin(u)};return f={x:f.x+c*Math.cos(l-Math.PI),y:f.y+c*Math.sin(l-Math.PI)},p={x:p.x+c*Math.cos(u-Math.PI),y:p.y+c*Math.sin(u-Math.PI)},t.push({x:e.x,y:e.y}),t.push({x:f.x,y:f.y}),t.push({x:p.x,y:p.y}),t.push({x:i.x,y:i.y}),t},U.prototype.paintPath=function(t,e){if(this.nodeA!==this.nodeZ){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)null==this.dashedPattern?t.lineTo(e[i].x,e[i].y):t.JTopoDashedLineTo(e[i-1].x,e[i-1].y,e[i].x,e[i].y,this.dashedPattern);if(t.stroke(),t.closePath(),null!=this.arrowsRadius){var s=e[e.length-2],n=e[e.length-1];this.paintArrow(t,s,n)}}else this.paintLoop(t)},U.prototype.paintLoop=function(t){t.beginPath();var e=this.bundleGap*(this.nodeIndex+1)/2;Math.PI,Math.PI,t.arc(this.nodeA.x,this.nodeA.y,e,Math.PI/2,2*Math.PI),t.stroke(),t.closePath()},U.prototype.paintArrow=function(t,e,i,s){var n=this.arrowsOffset,o=this.arrowsRadius/2,h=e,r=i,a=Math.atan2(r.y-h.y,r.x-h.x),l=x.getDistance(h,r)-this.arrowsRadius,u=h.x+(l+n)*Math.cos(a),c=h.y+(l+n)*Math.sin(a),d=r.x+n*Math.cos(a),f=r.y+n*Math.sin(a);a-=Math.PI/2;var p={x:u+o*Math.cos(a),y:c+o*Math.sin(a)},g={x:u+o*Math.cos(a-Math.PI),y:c+o*Math.sin(a-Math.PI)};t.beginPath(),t.fillStyle="rgba("+this.strokeColor+","+this.alpha+")",t.moveTo(p.x,p.y),t.lineTo(d,f),t.lineTo(g.x,g.y),t.stroke(),t.closePath(),s||this.bothArrow&&this.paintArrow(t,i,e,!0)},U.prototype.paint=function(t){if(null!=this.nodeA&&null!=!this.nodeZ){var e=this.getPath(this.nodeIndex);this.path=e,t.strokeStyle="rgba("+this.strokeColor+","+this.alpha+")",t.lineWidth=this.lineWidth,this.paintPath(t,e),e&&e.length>0&&this.paintText(t,e)}},U.prototype.paintText=function(t,e){var i=e[0],s=e[e.length-1];if(4==e.length&&(i=e[1],s=e[2]),this.text&&this.text.length>0){var n=(s.x+i.x)/2+this.textOffsetX,o=(s.y+i.y)/2+this.textOffsetY;t.save(),t.beginPath(),t.font=this.font;var h=t.measureText(this.text).width,r=t.measureText("田").width;if(t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",this.nodeA===this.nodeZ){var a=this.bundleGap*(this.nodeIndex+1)/2;n=this.nodeA.x+a*Math.cos(X),o=this.nodeA.y+a*Math.sin(X);t.fillText(this.text,n,o)}else t.fillText(this.text,n-h/2,o-r/2);t.stroke(),t.closePath(),t.restore()}},U.prototype.paintSelected=function(t){t.shadowBlur=10,t.shadowColor="rgba(0,0,0,1)",t.shadowOffsetX=0,t.shadowOffsetY=0},U.prototype.isInBound=function(t,e){if(this.nodeA===this.nodeZ){var i=this.bundleGap*(this.nodeIndex+1)/2,s=x.getDistance(this.nodeA,{x:t,y:e})-i;return Math.abs(s)<=3}for(var n=!1,o=1;o<this.path.length;o++){var h=this.path[o-1],r=this.path[o];if(1==x.isPointInLine({x:t,y:e},h,r)){n=!0;break}}return n};var K=U;function Q(t){this.initialize(),null!=t&&(t.add(this),this.addTo(t)),this.touchstart=this.mousedownHander,this.touchmove=this.mousedragHandler,this.touchend=this.mousedownHander;var e=this;"click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,touchstart,touchmove,touchend,keydown,keyup".split(",").forEach(function(t){e[t]=function(e){null!=e?this.addEventListener(t,e):this.dispatchEvent(t)}})}o(Q,_),Q.prototype.initialize=function(){Q.super.initialize.apply(this,arguments),this.messageBus=new E,this.elementType="scene",this.childs=[],this.zIndexMap={},this.zIndexArray=[],this.backgroundColor="255,255,255",this.visible=!0,this.alpha=0,this.scaleX=1,this.scaleY=1,this.mode=T,this.translate=!0,this.translateX=0,this.translateY=0,this.lastTranslateX=0,this.lastTranslateY=0,this.mouseDown=!1,this.mouseDownX=null,this.mouseDownY=null,this.mouseDownEvent=null,this.areaSelect=!0,this.operations=[],this.selectedElements=[],this.paintAll=!1;var t="background,backgroundColor,mode,paintAll,areaSelect,translate,translateX,translateY,lastTranslatedX,lastTranslatedY,alpha,visible,scaleX,scaleY".split(",");this.serializedProperties=this.serializedProperties.concat(t)},Q.prototype.setBackground=function(t){this.background=t},Q.prototype.addTo=function(t){this.stage!==t&&null!=t&&(this.stage=t)},Q.prototype.show=function(){this.visible=!0},Q.prototype.hide=function(){this.visible=!1},Q.prototype.paint=function(t){if(0!=this.visible&&null!=this.stage){if(t.save(),this.paintBackgroud(t),t.restore(),t.save(),t.scale(this.scaleX,this.scaleY),1==this.translate){var e=this.getOffsetTranslate(t);t.translate(e.translateX,e.translateY)}this.paintChilds(t),t.restore(),t.save(),this.paintOperations(t,this.operations),t.restore()}},Q.prototype.repaint=function(t){0!=this.visible&&this.paint(t)},Q.prototype.paintBackgroud=function(t){null!=this.background?t.drawImage(this.background,0,0,t.canvas.width,t.canvas.height):(t.beginPath(),t.fillStyle="rgba("+this.backgroundColor+","+this.alpha+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.closePath())},Q.prototype.getDisplayedElements=function(){for(var t=[],e=0;e<this.zIndexArray.length;e++)for(var i=this.zIndexArray[e],s=this.zIndexMap[i],n=0;n<s.length;n++){var o=s[n];this.isVisiable(o)&&t.push(o)}return t},Q.prototype.getDisplayedNodes=function(){for(var t=[],e=0;e<this.childs.length;e++){var i=this.childs[e];i instanceof V&&this.isVisiable(i)&&t.push(i)}return t},Q.prototype.paintChilds=function(t){for(var e=0;e<this.zIndexArray.length;e++)for(var i=this.zIndexArray[e],s=this.zIndexMap[i],n=0;n<s.length;n++){var o=s[n];if(1==this.paintAll||this.isVisiable(o)){if(t.save(),1==o.transformAble){var h=o.getCenterLocation();t.translate(h.x,h.y),o.rotate&&t.rotate(o.rotate),o.scaleX&&o.scaleY?t.scale(o.scaleX,o.scaleY):o.scaleX?t.scale(o.scaleX,1):o.scaleY&&t.scale(1,o.scaleY)}1==o.shadow&&(t.shadowBlur=o.shadowBlur,t.shadowColor=o.shadowColor,t.shadowOffsetX=o.shadowOffsetX,t.shadowOffsetY=o.shadowOffsetY),o instanceof Z&&(o.selected&&1==o.showSelected&&o.paintSelected(t),1==o.isMouseOver&&o.paintMouseover(t)),o.paint(t),t.restore()}}},Q.prototype.getOffsetTranslate=function(t){var e=this.stage.canvas.width,i=this.stage.canvas.height;null!=t&&"move"!=t&&(e=t.canvas.width,i=t.canvas.height);var s=e/this.scaleX/2,n=i/this.scaleY/2;return{translateX:this.translateX+(s-s*this.scaleX),translateY:this.translateY+(n-n*this.scaleY)}},Q.prototype.isVisiable=function(t){if(1!=t.visible)return!1;if(t instanceof K)return!0;var e=this.getOffsetTranslate(),i=t.x+e.translateX,s=t.y+e.translateY;i*=this.scaleX,s*=this.scaleY;var n=i+t.width*this.scaleX,o=s+t.height*this.scaleY;return!(i>this.stage.canvas.width||s>this.stage.canvas.height||n<0||o<0)},Q.prototype.paintOperations=function(t,e){for(var i=0;i<e.length;i++)e[i](t)},Q.prototype.findElements=function(t){for(var e=[],i=0;i<this.childs.length;i++)1==t(this.childs[i])&&e.push(this.childs[i]);return e},Q.prototype.getElementsByClass=function(t){return this.findElements(function(e){return e instanceof t})},Q.prototype.addOperation=function(t){return this.operations.push(t),this},Q.prototype.clearOperations=function(){return this.operations=[],this},Q.prototype.getElementByXY=function(t,e){for(var i=null,s=this.zIndexArray.length-1;s>=0;s--)for(var n=this.zIndexArray[s],o=this.zIndexMap[n],h=o.length-1;h>=0;h--){var r=o[h];if(r instanceof Z&&this.isVisiable(r)&&r.isInBound(t,e))return r}return i},Q.prototype.add=function(t){this.childs.push(t),null==this.zIndexMap[t.zIndex]&&(this.zIndexMap[t.zIndex]=[],this.zIndexArray.push(t.zIndex),this.zIndexArray.sort(function(t,e){return t-e})),this.zIndexMap[""+t.zIndex].push(t)},Q.prototype.remove=function(t){this.childs=x.removeFromArray(this.childs,t);var e=this.zIndexMap[t.zIndex];e&&(this.zIndexMap[t.zIndex]=x.removeFromArray(e,t)),t.removeHandler(this)},Q.prototype.clear=function(){var t=this;this.childs.forEach(function(e){e.removeHandler(t)}),this.childs=[],this.operations=[],this.zIndexArray=[],this.zIndexMap={}},Q.prototype.addToSelected=function(t){this.selectedElements.push(t)},Q.prototype.cancleAllSelected=function(t){for(var e=0;e<this.selectedElements.length;e++)this.selectedElements[e].unselectedHandler(t);this.selectedElements=[]},Q.prototype.notInSelectedNodes=function(t){for(var e=0;e<this.selectedElements.length;e++)if(t===this.selectedElements[e])return!1;return!0},Q.prototype.removeFromSelected=function(t){for(var e=0;e<this.selectedElements.length;e++){t===this.selectedElements[e]&&(this.selectedElements=n.call(this.selectedElements,e))}},Q.prototype.toSceneEvent=function(t){var e=x.clone(t);if(e.x/=this.scaleX,e.y/=this.scaleY,1==this.translate){var i=this.getOffsetTranslate();e.x-=i.translateX,e.y-=i.translateY}return null!=e.dx&&(e.dx/=this.scaleX,e.dy/=this.scaleY),null!=this.currentElement&&(e.target=this.currentElement),e.scene=this,e},Q.prototype.selectElement=function(t){var e=this.getElementByXY(t.x,t.y);if(null!=e)if(t.target=e,e.mousedownHander(t),e.selectedHandler(t),this.notInSelectedNodes(e))t.ctrlKey||this.cancleAllSelected(),this.addToSelected(e);else{1==t.ctrlKey&&(e.unselectedHandler(),this.removeFromSelected(e));for(var i=0;i<this.selectedElements.length;i++){this.selectedElements[i].selectedHandler(t)}}else t.ctrlKey||this.cancleAllSelected();this.currentElement=e},Q.prototype.mousedownHandler=function(t){var e=this.toSceneEvent(t);if(this.mouseDown=!0,this.mouseDownX=e.x,this.mouseDownY=e.y,this.mouseDownEvent=e,this.mode==T)this.selectElement(e),(null==this.currentElement||this.currentElement instanceof K)&&1==this.translate&&(this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY);else{if(this.mode==P&&1==this.translate)return this.lastTranslateX=this.translateX,void(this.lastTranslateY=this.translateY);this.mode==M?this.selectElement(e):this.mode==S&&(this.selectElement(e),(null==this.currentElement||this.currentElement instanceof K)&&1==this.translate&&(this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY))}this.dispatchEvent("mousedown",e)},Q.prototype.mouseupHandler=function(t){this.stage.cursor!=k&&(this.stage.cursor=k),this.clearOperations();var e=this.toSceneEvent(t);null!=this.currentElement&&(e.target=this.currentElement,this.currentElement.mouseupHandler(e)),this.dispatchEvent("mouseup",e),this.mouseDown=!1},Q.prototype.dragElements=function(t){if(null!=this.currentElement&&1==this.currentElement.dragable)for(var e=0;e<this.selectedElements.length;e++){var i=this.selectedElements[e];if(0!=i.dragable){var s=x.clone(t);s.target=i,i.mousedragHandler(s)}}},Q.prototype.mousedragHandler=function(t){var e=this.toSceneEvent(t);this.mode==T?null==this.currentElement||this.currentElement instanceof K?1==this.translate&&(this.stage.cursor=L,this.translateX=this.lastTranslateX+e.dx,this.translateY=this.lastTranslateY+e.dy):this.dragElements(e):this.mode==P?1==this.translate&&(this.stage.cursor=L,this.translateX=this.lastTranslateX+e.dx,this.translateY=this.lastTranslateY+e.dy):this.mode==M?null!=this.currentElement?1==this.currentElement.dragable&&this.dragElements(e):1==this.areaSelect&&this.areaSelectHandle(e):this.mode==S&&(null==this.currentElement||this.currentElement instanceof K?1==this.translate&&(this.stage.cursor=L,this.translateX=this.lastTranslateX+e.dx,this.translateY=this.lastTranslateY+e.dy):this.dragElements(e)),this.dispatchEvent("mousedrag",e)},Q.prototype.areaSelectHandle=function(t){var e=t.offsetLeft,i=t.offsetTop,s=this.mouseDownEvent.offsetLeft,n=this.mouseDownEvent.offsetTop,o=e>=s?s:e,h=i>=n?n:i,r=Math.abs(t.dx)*this.scaleX,a=Math.abs(t.dy)*this.scaleY,l=new function(t,e,i,s){return function(n){n.beginPath(),n.strokeStyle="rgba(0,0,236,0.5)",n.fillStyle="rgba(0,0,236,0.1)",n.rect(t,e,i,s),n.fill(),n.stroke(),n.closePath()}}(o,h,r,a);this.clearOperations().addOperation(l),e=t.x,i=t.y,s=this.mouseDownEvent.x,n=this.mouseDownEvent.y,o=e>=s?s:e,h=i>=n?n:i;for(var u=this,c=o+(r=Math.abs(t.dx)),d=h+(a=Math.abs(t.dy)),f=0;f<u.childs.length;f++){var p=u.childs[f];p.x>o&&p.x+p.width<c&&p.y>h&&p.y+p.height<d&&u.notInSelectedNodes(p)&&(p.selectedHandler(t),u.addToSelected(p))}},Q.prototype.mousemoveHandler=function(t){this.mousecoord={x:t.x,y:t.y};var e=this.toSceneEvent(t);if(this.mode!=P){this.mode==T?this.stage.cursor=k:this.mode==M&&(this.stage.cursor=k);var i=this.getElementByXY(e.x,e.y);null!=i?(this.mouseOverelement&&this.mouseOverelement!==i&&(e.target=i,this.mouseOverelement.mouseoutHandler(e)),this.mouseOverelement=i,0==i.isMouseOver?(e.target=i,i.mouseoverHandler(e),this.dispatchEvent("mouseover",e)):(e.target=i,i.mousemoveHandler(e),this.dispatchEvent("mousemove",e))):this.mouseOverelement?(e.target=i,this.mouseOverelement.mouseoutHandler(e),this.mouseOverelement=null,this.dispatchEvent("mouseout",e)):(e.target=null,this.dispatchEvent("mousemove",e))}else this.stage.cursor=I},Q.prototype.mouseoverHandler=function(t){var e=this.toSceneEvent(t);this.dispatchEvent("mouseover",e)},Q.prototype.mouseoutHandler=function(t){var e=this.toSceneEvent(t);this.dispatchEvent("mouseout",e)},Q.prototype.clickHandler=function(t){var e=this.toSceneEvent(t);this.currentElement&&(e.target=this.currentElement,this.currentElement.clickHandler(e)),this.dispatchEvent("click",e)},Q.prototype.dbclickHandler=function(t){var e=this.toSceneEvent(t);this.currentElement?(e.target=this.currentElement,this.currentElement.dbclickHandler(e)):this.cancleAllSelected(),this.dispatchEvent("dbclick",e)},Q.prototype.mousewheelHandler=function(t){var e=this.toSceneEvent(t);this.dispatchEvent("mousewheel",e)},Q.prototype.keydownHandler=function(t){this.dispatchEvent("keydown",t)},Q.prototype.keyupHandler=function(t){this.dispatchEvent("keyup",t)},Q.prototype.addEventListener=function(t,e){var i=this;return this.messageBus.subscribe(t,function(t){e.call(i,t)}),this},Q.prototype.removeEventListener=function(t){this.messageBus.unsubscribe(t)},Q.prototype.removeAllEventListener=function(){this.messageBus=new E},Q.prototype.dispatchEvent=function(t,e){return this.messageBus.publish(t,e),this},Q.prototype.zoom=function(t,e){null!=t&&0!=t&&(this.scaleX=t),null!=e&&0!=e&&(this.scaleY=e)},Q.prototype.zoomOut=function(t){0!=t&&(null==t&&(t=.8),this.scaleX/=t,this.scaleY/=t)},Q.prototype.zoomIn=function(t){0!=t&&(null==t&&(t=.8),this.scaleX*=t,this.scaleY*=t)},Q.prototype.getBound=function(){return{left:0,top:0,right:this.stage.canvas.width,bottom:this.stage.canvas.height,width:this.stage.canvas.width,height:this.stage.canvas.height}},Q.prototype.getElementsBound=function(){return x.getElementsBound(this.childs)},Q.prototype.translateToCenter=function(t){var e=this.getElementsBound(),i=this.stage.canvas.width/2-(e.left+e.right)/2,s=this.stage.canvas.height/2-(e.top+e.bottom)/2;t&&(i=t.canvas.width/2-(e.left+e.right)/2,s=t.canvas.height/2-(e.top+e.bottom)/2),this.translateX=i,this.translateY=s},Q.prototype.setCenter=function(t,e){var i=t-this.stage.canvas.width/2,s=e-this.stage.canvas.height/2;this.translateX=-i,this.translateY=-s},Q.prototype.centerAndZoom=function(t,e,i){if(this.translateToCenter(i),null==t||null==e){var s=this.getElementsBound(),n=s.right-s.left,o=s.bottom-s.top,h=this.stage.canvas.width/n,r=this.stage.canvas.height/o;i&&(h=i.canvas.width/n,r=i.canvas.height/o);var a=Math.min(h,r);if(a>1)return;this.zoom(a,a)}this.zoom(t,e)},Q.prototype.getCenterLocation=function(){return{x:this.stage.canvas.width/2,y:this.stage.canvas.height/2}},Q.prototype.doLayout=function(t){t&&t(this,this.childs)},Q.prototype.toJson=function(){var t=this,e="{";this.serializedProperties.length,this.serializedProperties.forEach(function(i){var s=t[i];"background"==i&&(s=t._background.src),"string"==typeof s&&(s='"'+s+'"'),e+='"'+i+'":'+s+","}),e+='"childs":[';var i=this.childs.length;return this.childs.forEach(function(t,s){e+=t.toJson(),i>s+1&&(e+=",")}),e+="]",e+="}"};var $={};Object.defineProperties(Q.prototype,{background:{get:function(){return this._background},set:function(t){if("string"==typeof t){var e=$[t];null==e&&((e=new Image).src=t,e.onload=function(){$[t]=e}),this._background=e}else this._background=t}}});var tt=Q;function et(t){this.initialize(),this.text=t,this.elementType="TextNode"}o(et,V),et.prototype.paint=function(t){t.beginPath(),t.font=this.font,this.width=t.measureText(this.text).width,this.height=t.measureText("田").width,t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.text,-this.width/2,this.height/2),t.closePath(),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)};var it=et;function st(t,e,i){this.initialize(),this.text=t,this.href=e,this.target=i,this.elementType="LinkNode",this.isVisited=!1,this.visitedColor=null,this.mousemove(function(){var t=document.getElementsByTagName("canvas");if(t&&t.length>0)for(var e=0;e<t.length;e++)t[e].style.cursor="pointer"}),this.mouseout(function(){var t=document.getElementsByTagName("canvas");if(t&&t.length>0)for(var e=0;e<t.length;e++)t[e].style.cursor="default"}),this.click(function(){"_blank"==this.target?window.open(this.href):location=this.href,this.isVisited=!0})}o(st,it),st.prototype.paint=function(t){t.beginPath(),t.font=this.font,this.width=t.measureText(this.text).width,this.height=t.measureText("田").width,this.isVisited&&null!=this.visitedColor?(t.strokeStyle="rgba("+this.visitedColor+", "+this.alpha+")",t.fillStyle="rgba("+this.visitedColor+", "+this.alpha+")"):(t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")"),t.fillText(this.text,-this.width/2,this.height/2),this.isMouseOver&&(t.moveTo(-this.width/2,this.height),t.lineTo(this.width/2,this.height),t.stroke()),t.closePath(),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)};var nt=st;function ot(t){this.initialize(arguments),this._radius=20,this.beginDegree=0,this.endDegree=2*Math.PI,this.text=t}o(ot,V),Object.defineProperties(ot.prototype,{radius:{get:function(){return this._radius},set:function(t){this._radius=t;var e=2*this.radius,i=2*this.radius;this.width=e,this.height=i}},width:{get:function(){return this._width},set:function(t){this._radius=t/2,this._width=t}},height:{get:function(){return this._height},set:function(t){this._radius=t/2,this._height=t}}}),ot.prototype.paint=function(t){t.save(),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",t.arc(0,0,this.radius,this.beginDegree,this.endDegree,!0),t.fill(),t.closePath(),t.restore(),this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},ot.prototype.paintSelected=function(t){t.save(),t.beginPath(),t.strokeStyle="rgba(168,202,255, 0.9)",t.fillStyle="rgba(168,202,236,0.7)",t.arc(0,0,this.radius+3,this.beginDegree,this.endDegree,!0),t.fill(),t.stroke(),t.closePath(),t.restore()};var ht=ot;function rt(t,e,i){this.initialize(),this.frameImages=t||[],this.frameIndex=0,this.isStop=!0;var s=e||1e3;this.repeatPlay=!1;var n=this;this.nextFrame=function(){if(!this.isStop&&null!=this.frameImages.length){if(this.frameIndex++,this.frameIndex>=this.frameImages.length){if(!this.repeatPlay)return;this.frameIndex=0}this.setImage(this.frameImages[this.frameIndex],i),setTimeout(function(){n.nextFrame()},s/t.length)}}}function at(t,e,i,s,n){this.initialize();var o=this;this.setImage(t),this.frameIndex=0,this.isPause=!0,this.repeatPlay=!1;var h=s||1e3;n=n||0,this.paint=function(t){if(this.image){var e=this.width,s=this.height;t.save(),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")";var o=(Math.floor(this.frameIndex/i)+n)*s,h=Math.floor(this.frameIndex%i)*e;t.drawImage(this.image,h,o,e,s,-e/2,-s/2,e,s),t.fill(),t.closePath(),t.restore(),this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)}},this.nextFrame=function(){if(!this.isStop){if(this.frameIndex++,this.frameIndex>=e*i){if(!this.repeatPlay)return;this.frameIndex=0}setTimeout(function(){o.isStop||o.nextFrame()},h/(e*i))}}}function lt(){var t=null;return(t=arguments.length<=3?new rt(arguments[0],arguments[1],arguments[2]):new at(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])).stop=function(){t.isStop=!0},t.play=function(){t.isStop=!1,t.frameIndex=0,t.nextFrame()},t}o(rt,V),o(at,V),o(lt,V);var ut=lt;function ct(t,e,i){this.initialize(t,e,i)}o(ct,K),ct.prototype.initialize=function(){ct.super.initialize.apply(this,arguments),this.direction="horizontal"},ct.prototype.getStartPosition=function(){var t={x:this.nodeA.cx,y:this.nodeA.cy};return"horizontal"==this.direction?this.nodeZ.cx>t.x?t.x+=this.nodeA.width/2:t.x-=this.nodeA.width/2:this.nodeZ.cy>t.y?t.y+=this.nodeA.height/2:t.y-=this.nodeA.height/2,t},ct.prototype.getEndPosition=function(){var t={x:this.nodeZ.cx,y:this.nodeZ.cy};return"horizontal"==this.direction?this.nodeA.cy<t.y?t.y-=this.nodeZ.height/2:t.y+=this.nodeZ.height/2:t.x=this.nodeA.cx<t.x?this.nodeZ.x:this.nodeZ.x+this.nodeZ.width,t},ct.prototype.getPath=function(t){var e=[],i=this.getStartPosition(),s=this.getEndPosition();if(this.nodeA===this.nodeZ)return[i,s];var n,o,h=(G(this.nodeA,this.nodeZ)-1)*this.bundleGap,r=this.bundleGap*t-h/2;return"horizontal"==this.direction?(n=s.x+r,o=i.y-r,e.push({x:i.x,y:o}),e.push({x:n,y:o}),e.push({x:n,y:s.y})):(n=i.x+r,o=s.y-r,e.push({x:n,y:i.y}),e.push({x:n,y:o}),e.push({x:s.x,y:o})),e},ct.prototype.paintText=function(t,e){if(this.text&&this.text.length>0){var i=e[1],s=i.x+this.textOffsetX,n=i.y+this.textOffsetY;t.save(),t.beginPath(),t.font=this.font;var o=t.measureText(this.text).width,h=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.text,s-o/2,n-h/2),t.stroke(),t.closePath(),t.restore()}};var dt=ct;function ft(t,e,i){this.initialize(t,e,i)}o(ft,K),ft.prototype.initialize=function(){ft.super.initialize.apply(this,arguments),this.direction="vertical",this.offsetGap=44},ft.prototype.getStartPosition=function(){var t={x:this.nodeA.cx,y:this.nodeA.cy};return"horizontal"==this.direction?t.x=this.nodeZ.cx<t.x?this.nodeA.x:this.nodeA.x+this.nodeA.width:t.y=this.nodeZ.cy<t.y?this.nodeA.y:this.nodeA.y+this.nodeA.height,t},ft.prototype.getEndPosition=function(){var t={x:this.nodeZ.cx,y:this.nodeZ.cy};return"horizontal"==this.direction?t.x=this.nodeA.cx<t.x?this.nodeZ.x:this.nodeZ.x+this.nodeZ.width:t.y=this.nodeA.cy<t.y?this.nodeZ.y:this.nodeZ.y+this.nodeZ.height,t},ft.prototype.getPath=function(t){var e=this.getStartPosition(),i=this.getEndPosition();if(this.nodeA===this.nodeZ)return[e,i];var s=[],n=(G(this.nodeA,this.nodeZ)-1)*this.bundleGap,o=this.bundleGap*t-n/2,h=this.offsetGap;return"horizontal"==this.direction?(this.nodeA.cx>this.nodeZ.cx&&(h=-h),s.push({x:e.x,y:e.y+o}),s.push({x:e.x+h,y:e.y+o}),s.push({x:i.x-h,y:i.y+o}),s.push({x:i.x,y:i.y+o})):(this.nodeA.cy>this.nodeZ.cy&&(h=-h),s.push({x:e.x+o,y:e.y}),s.push({x:e.x+o,y:e.y+h}),s.push({x:i.x+o,y:i.y-h}),s.push({x:i.x+o,y:i.y})),s};var pt=ft;function gt(t,e,i){this.initialize(t,e,i)}o(gt,K),gt.prototype.initialize=function(){gt.super.initialize.apply(this,arguments)},gt.prototype.paintPath=function(t,e){if(this.nodeA!==this.nodeZ){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++){var s=e[i-1],n=e[i],o=(s.x+n.x)/2,h=(s.y+n.y)/2;h+=(n.y-s.y)/2,t.strokeStyle="rgba("+this.strokeColor+","+this.alpha+")",t.lineWidth=this.lineWidth,t.moveTo(s.x,s.cy),t.quadraticCurveTo(o,h,n.x,n.y),t.stroke()}if(t.stroke(),t.closePath(),null!=this.arrowsRadius){var r=e[e.length-2],a=e[e.length-1];this.paintArrow(t,r,a)}}else this.paintLoop(t)};var vt=gt;function yt(t){var e=[],i=t.filter(function(t){return t instanceof JTopo.Link||(e.push(t),!1)});return(t=e.filter(function(t){for(var e=0;e<i.length;e++)if(i[e].nodeZ===t)return!1;return!0})).filter(function(t){for(var e=0;e<i.length;e++)if(i[e].nodeA===t)return!0;return!1})}function mt(t){var e=0,i=0;return t.forEach(function(t){e+=t.width,i+=t.height}),{width:e/t.length,height:i/t.length}}function xt(t,e,i,s){e.x+=i,e.y+=s;for(var n=bt(t,e),o=0;o<n.length;o++)xt(t,n[o],i,s)}function wt(t,e){if(t.layout){var i=t.layout,s=i.type,n=null;if("circle"==s){var o=i.radius||Math.max(t.width,t.height);n=function(t,e,i,s,n,o){for(var h=n||0,r=o||2*Math.PI,a=(r-h)/i,l=[],u=h+=a/2;r>=u;u+=a){var c=t+Math.cos(u)*s,d=e+Math.sin(u)*s;l.push({x:c,y:d})}return l}(t.cx,t.cy,e.length,o,t.layout.beginAngle,t.layout.endAngle)}else if("tree"==s){var h=i.width||50,r=i.height||50,a=i.direction;n=function(t,e,i,s,n,o){var h=o||"bottom",r=[];if("bottom"==h)for(var a=t-i/2*s+s/2,l=0;i>=l;l++)r.push({x:a+l*s,y:e+n});else if("top"==h)for(a=t-i/2*s+s/2,l=0;i>=l;l++)r.push({x:a+l*s,y:e-n});else if("right"==h)for(a=e-i/2*s+s/2,l=0;i>=l;l++)r.push({x:t+n,y:a+l*s});else if("left"==h)for(a=e-i/2*s+s/2,l=0;i>=l;l++)r.push({x:t-n,y:a+l*s});return r}(t.cx,t.cy,e.length,h,r,a)}else{if("grid"!=s)return;n=function(t,e,i,s,n,o){for(var h=[],r=0;i>r;r++)for(var a=0;s>a;a++)h.push({x:t+a*n,y:e+r*o});return h}(t.x,t.y,i.rows,i.cols,i.horizontal||0,i.vertical||0)}for(var l=0;l<e.length;l++)e[l].setCenterLocation(n[l].x,n[l].y)}}function bt(t,e){for(var i=[],s=0;s<t.length;s++)t[s]instanceof JTopo.Link&&t[s].nodeA===e&&i.push(t[s].nodeZ);return i}function Et(t,e){var i=0;return function t(e,s,n){var o=bt(e,s);n>i&&(i=n);for(var h=0;h<o.length;h++)t(e,o[h],n+1)}(t,e,0),i}var Tt={layoutNode:function t(e,i,s){var n=bt(e.childs,i);if(0==n.length)return null;if(wt(i,n),1==s)for(var o=0;o<n.length;o++)t(e,n[o],s);return null},getNodeChilds:bt,adjustPosition:wt,springLayout:function(t,e){function i(t,e){var i=t.x-e.x,a=t.y-e.y;h+=i*s,r+=a*s,h*=n,r*=n,r+=o,e.x+=h,e.y+=r}var s=.01,n=.95,o=-5,h=0,r=0,a=0,l=e.getElementsByClass(JTopo.Node);!function e(){if(!(++a>150)){for(var s=0;s<l.length;s++)l[s]!=t&&i(t,l[s]);setTimeout(e,1e3/24)}}()},getTreeDeep:Et,getRootNodes:yt,GridLayout:function(t,e){return function(i){var s=i.childs;if(!(s.length<=0))for(var n=i.getBound(),o=s[0],h=(n.width-o.width)/e,r=(n.height-o.height)/t,a=(s.length,0),l=0;t>l;l++)for(var u=0;e>u;u++){var c=s[a++],d=n.left+h/2+u*h,f=n.top+r/2+l*r;if(c.setLocation(d,f),a>=s.length)return}}},FlowLayout:function(t,e){return null==t&&(t=0),null==e&&(e=0),function(i){var s=i.childs;if(!(s.length<=0))for(var n=i.getBound(),o=n.left,h=n.top,r=0;r<s.length;r++){var a=s[r];o+a.width>=n.right&&(o=n.left,h+=e+a.height),a.setLocation(o,h),o+=t+a.width}}},AutoBoundLayout:function(){return function(t,e){if(e.length>0){for(var i=1e7,s=-1e7,n=1e7,o=-1e7,h=s-i,r=o-n,a=0;a<e.length;a++){var l=e[a];l.x<=i&&(i=l.x),l.x>=s&&(s=l.x),l.y<=n&&(n=l.y),l.y>=o&&(o=l.y),h=s-i+l.width,r=o-n+l.height}t.x=i,t.y=n,t.width=h,t.height=r}}},FixedBoundLayout:function(){return function(t,e){if(e.length>0)for(bound=t.getBound(),xt=0;xt<e.length;xt++){var i=e[xt],s=i.x,n=i.y;i.x+i.width>bound.right&&(s=bound.right-i.width),i.x<bound.left&&(s=bound.left),i.y<bound.top&&(n=bound.top),i.y+i.height>bound.bottom&&(n=bound.bottom-i.height),i.setLocation(s,n)}}},CircleLayout:function(t){return function(e){var i=yt(e.childs);if(i.length>0){!function e(i,s,n){var o=q(i,s);if(0!=o.length){null==n&&(n=t);var h=2*Math.PI/o.length;o.forEach(function(t,o){var r=s.x+n*Math.cos(h*o),a=s.y+n*Math.sin(h*o);t.setLocation(r,a),e(i,t,n/2)})}}(e.childs,i[0]);var s=x.getElementsBound(e.childs),n=e.getCenterLocation(),o=n.x-(s.left+s.right)/2,h=n.y-(s.top+s.bottom)/2;e.childs.forEach(function(t){t instanceof JTopo.Node&&(t.x+=o,t.y+=h)})}}},TreeLayout:function(t,e,i){return function(s){var n=null;null==e&&(n=mt(s.childs),e=n.width,("left"==t||"right"==t)&&(e=n.width+10)),null==i&&(null==n&&(n=mt(s.childs)),i=2*n.height),null==t&&(t="down");var o=yt(s.childs);if(o.length>0){!function(n,o){for(var h=Et(n,o),r=function(t,e){var i=[];return function e(s,n){var o=bt(t,s);null==i[n]&&(i[n]={},i[n].nodes=[],i[n].childs=[]),i[n].nodes.push(s),i[n].childs.push(o);for(var h=0;h<o.length;h++)e(o[h],n+1),o[h].parent=s}(e,0),i}(n,o),a=r[""+h].nodes,l=0;l<a.length;l++){var u=a[l],c=(l+1)*(e+10),d=h*i;"down"==t||("up"==t?d=-d:"left"==t?(c=-h*i,d=(l+1)*(e+10)):"right"==t&&(c=h*i,d=(l+1)*(e+10))),u.setLocation(c,d)}for(var f=h-1;f>=0;f--){var p=r[""+f].nodes,g=r[""+f].childs;for(l=0;l<p.length;l++){var v=p[l],y=g[l];if("down"==t?v.y=f*i:"up"==t?v.y=-f*i:"left"==t?v.x=-f*i:"right"==t&&(v.x=f*i),y.length>0?"down"==t||"up"==t?v.x=(y[0].x+y[y.length-1].x)/2:("left"==t||"right"==t)&&(v.y=(y[0].y+y[y.length-1].y)/2):l>0&&("down"==t||"up"==t?v.x=p[l-1].x+p[l-1].width+e:("left"==t||"right"==t)&&(v.y=p[l-1].y+p[l-1].height+e)),l>0)if("down"==t||"up"==t){if(v.x<p[l-1].x+p[l-1].width)for(var m=p[l-1].x+p[l-1].width+e,x=Math.abs(m-v.x),w=l;w<p.length;w++)xt(s.childs,p[w],x,0)}else if(("left"==t||"right"==t)&&v.y<p[l-1].y+p[l-1].height){var b=p[l-1].y+p[l-1].height+e,E=Math.abs(b-v.y);for(w=l;w<p.length;w++)xt(s.childs,p[w],0,E)}}}}(s.childs,o[0]);var h=x.getElementsBound(s.childs),r=s.getCenterLocation(),a=r.x-(h.left+h.right)/2,l=r.y-(h.top+h.bottom)/2;s.childs.forEach(function(t){t instanceof JTopo.Node&&(t.x+=a,t.y+=l)})}}},getNodesCenter:function(t){var e=0,i=0;return t.forEach(function(t){e+=t.cx,i+=t.cy}),{x:e/t.length,y:i/t.length}},circleLayoutNodes:function(t,e){null==e&&(e={});var i=e.cx,s=e.cy,n=e.minRadius,o=e.nodeDiameter,h=e.hScale||1,r=e.vScale||1;if(e.beginAngle,e.endAngle||Math.PI,null==i||null==s){var l=b(t);i=l.x,s=l.y}var u=0,c=[],d=[];t.forEach(function(t){null==e.nodeDiameter?(t.diameter&&(o=t.diameter),o=t.radius?2*t.radius:Math.sqrt(2*t.width*t.height),d.push(o)):d.push(o),u+=o}),t.forEach(function(t,e){var i=d[e]/u;c.push(Math.PI*i)});var f=(t.length,c[0]+c[1]),p=(d[0]/2+d[1]/2)/2/Math.sin(f/2);null!=n&&n>p&&(p=n);var g=p*h,v=p*r,y=e.animate;if(y){var m=y.time||1e3,x=0;t.forEach(function(t,e){x+=0==e?c[e]:c[e-1]+c[e];var n=i+Math.cos(x)*g,o=s+Math.sin(x)*v;a.Animate.stepByStep(t,{x:n-t.width/2,y:o-t.height/2},m).start()})}else x=0,t.forEach(function(t,e){x+=0==e?c[e]:c[e-1]+c[e];var n=i+Math.cos(x)*g,o=s+Math.sin(x)*v;t.cx=n,t.cy=o});return{cx:i,cy:s,radius:g,radiusA:g,radiusB:v}}};function Pt(t){this.initialize(t)}o(Pt,Z),Pt.prototype.initialize=function(t){Pt.super.initialize.apply(this,null),this.elementType="container",this.zIndex=A,this.width=100,this.height=100,this.childs=[],this.alpha=.5,this.dragable=!0,this.childDragble=!0,this.visible=!0,this.fillColor="10,100,80",this.borderWidth=0,this.borderColor="255,255,255",this.borderRadius=null,this.font="12px Consolas",this.fontColor="255,255,255",this.text=t,this.textPosition="Bottom_Center",this.textOffsetX=0,this.textOffsetY=0,this.layout=new Tt.AutoBoundLayout},Pt.prototype.add=function(t){this.childs.push(t),t.dragable=this.childDragble},Pt.prototype.remove=function(t){for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t){t.parentContainer=null,this.childs=n.call(this.childs,e),t.lastParentContainer=this;break}},Pt.prototype.removeAll=function(){this.childs=[]},Pt.prototype.setLocation=function(t,e){var i=t-this.x,s=e-this.y;this.x=t,this.y=e;for(var n=0;n<this.childs.length;n++){var o=this.childs[n];o.setLocation(o.x+i,o.y+s)}},Pt.prototype.doLayout=function(t){t&&t(this,this.childs)},Pt.prototype.paint=function(t){this.visible&&(this.layout&&this.layout(this,this.childs),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",null==this.borderRadius||0==this.borderRadius?t.rect(this.x,this.y,this.width,this.height):t.JTopoRoundRect(this.x,this.y,this.width,this.height,this.borderRadius),t.fill(),t.closePath(),this.paintText(t),this.paintBorder(t))},Pt.prototype.paintBorder=function(t){if(0!=this.borderWidth){t.beginPath(),t.lineWidth=this.borderWidth,t.strokeStyle="rgba("+this.borderColor+","+this.alpha+")";var e=this.borderWidth/2;null==this.borderRadius||0==this.borderRadius?t.rect(this.x-e,this.y-e,this.width+this.borderWidth,this.height+this.borderWidth):t.JTopoRoundRect(this.x-e,this.y-e,this.width+this.borderWidth,this.height+this.borderWidth,this.borderRadius),t.stroke(),t.closePath()}},Pt.prototype.paintText=function(t){var e=this.text;if(null!=e&&""!=e){t.beginPath(),t.font=this.font;var i=t.measureText(e).width,s=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")";var n=this.getTextPostion(this.textPosition,i,s);t.fillText(e,n.x,n.y),t.closePath()}},Pt.prototype.getTextPostion=function(t,e,i){var s=null;return null==t||"Bottom_Center"==t?s={x:this.x+this.width/2-e/2,y:this.y+this.height+i}:"Top_Center"==t?s={x:this.x+this.width/2-e/2,y:this.y-i/2}:"Top_Right"==t?s={x:this.x+this.width-e,y:this.y-i/2}:"Top_Left"==t?s={x:this.x,y:this.y-i/2}:"Bottom_Right"==t?s={x:this.x+this.width-e,y:this.y+this.height+i}:"Bottom_Left"==t?s={x:this.x,y:this.y+this.height+i}:"Middle_Center"==t?s={x:this.x+this.width/2-e/2,y:this.y+this.height/2+i/2}:"Middle_Right"==t?s={x:this.x+this.width-e,y:this.y+this.height/2+i/2}:"Middle_Left"==t&&(s={x:this.x,y:this.y+this.height/2+i/2}),null!=this.textOffsetX&&(s.x+=this.textOffsetX),null!=this.textOffsetY&&(s.y+=this.textOffsetY),s},Pt.prototype.paintMouseover=function(){},Pt.prototype.paintSelected=function(t){t.shadowBlur=10,t.shadowColor="rgba(0,0,0,1)",t.shadowOffsetX=0,t.shadowOffsetY=0};var St=Pt;function Mt(t,e){this.x=t,this.y=e}function kt(t){this.p=new Mt(0,0),this.w=new Mt(1,0),this.paint=t}kt.prototype.forward=function(t){var e=this.p,i=this.w;return e.x=e.x+t*i.x,e.y=e.y+t*i.y,this.paint&&this.paint(e.x,e.y),this},kt.prototype.move=function(t){var e=this.p,i=this.w;return e.x=e.x+t*i.x,e.y=e.y+t*i.y,this},kt.prototype.moveTo=function(t,e){return this.p.x=t,this.p.y=e,this},kt.prototype.turn=function(t){var e=(this.p,this.w),i=Math.cos(t)*e.x-Math.sin(t)*e.y,s=Math.sin(t)*e.x+Math.cos(t)*e.y;return e.x=i,e.y=s,this},kt.prototype.resize=function(t){var e=this.w;return e.x=e.x*t,e.y=e.y*t,this},kt.prototype.save=function(){return null==this._stack&&(this._stack=[]),this._stack.push([this.p,this.w]),this},kt.prototype.restore=function(){if(null!=this._stack&&this._stack.length>0){var t=this._stack.pop();this.p=t[0],this.w=t[1]}return this};var It=!1;function Lt(t,e){var i,s=null;return{stop:function(){return i?(window.clearInterval(i),s&&s.publish("stop"),this):this},start:function(){var s=this;return i=setInterval(function(){t.call(s)},e),this},onStop:function(t){return null==s&&(s=new E),s.subscribe("stop",t),this}}}var At={Stage:Y,Scene:tt,Node:V,TextNode:it,LinkNode:nt,CircleNode:ht,AnimateNode:ut,Link:K,FoldLink:dt,FlexionalLink:pt,CurveLink:vt,Container:St,PieChartNode:function(){var t=new ht;return t.radius=150,t.colors=["#3666B0","#2CA8E0","#77D1F6"],t.datas=[.3,.3,.4],t.titles=["A","B","C"],t.paint=function(e){var i=2*t.radius,s=2*t.radius;t.width=i,t.height=s;for(var n=0,o=0;o<this.datas.length;o++){var h=this.datas[o]*Math.PI*2;e.save(),e.beginPath(),e.fillStyle=t.colors[o],e.moveTo(0,0),e.arc(0,0,this.radius,n,n+h,!1),e.fill(),e.closePath(),e.restore(),e.beginPath(),e.font=this.font;var r=this.titles[o]+": "+(100*this.datas[o]).toFixed(2)+"%",a=e.measureText(r).width,l=(e.measureText("田").width,(n+n+h)/2),u=this.radius*Math.cos(l),c=this.radius*Math.sin(l);l>Math.PI/2&&l<=Math.PI?u-=a:l>Math.PI&&l<2*Math.PI*3/4?u-=a:Math.PI,e.fillStyle="#FFFFFF",e.fillText(r,u,c),e.moveTo(this.radius*Math.cos(l),this.radius*Math.sin(l)),l>Math.PI/2&&l<2*Math.PI*3/4&&(u-=a),Math.PI,e.fill(),e.stroke(),e.closePath(),n+=h}},t},BarChartNode:function(){var t=new V;return t.showSelected=!1,t.width=250,t.height=180,t.colors=["#3666B0","#2CA8E0","#77D1F6"],t.datas=[.3,.3,.4],t.titles=["A","B","C"],t.paint=function(e){var i=(this.width-3)/this.datas.length;e.save(),e.beginPath(),e.fillStyle="#FFFFFF",e.strokeStyle="#FFFFFF",e.moveTo(-this.width/2-1,-this.height/2),e.lineTo(-this.width/2-1,this.height/2+3),e.lineTo(this.width/2+3+1,this.height/2+3),e.stroke(),e.closePath(),e.restore();for(var s=0;s<this.datas.length;s++){e.save(),e.beginPath(),e.fillStyle=t.colors[s];var n=this.datas[s],o=s*(i+3)-this.width/2,h=this.height-n-this.height/2;e.fillRect(o,h,i,n);var r=""+parseInt(this.datas[s]),a=e.measureText(r).width,l=e.measureText("田").width;e.fillStyle="#FFFFFF",e.fillText(r,o+(i-a)/2,h-l),e.fillText(this.titles[s],o+(i-a)/2,this.height/2+l),e.fill(),e.closePath(),e.restore()}},t},Logo:{Tortoise:kt,shift:function(t,e,i){return function(s){for(var n=0;e>n;n++)t(),i&&s.turn(i),s.move(3)}},spin:function(t,e){var i=2*Math.PI;return function(s){for(var n=0;e>n;n++)t(),s.turn(i/e)}},polygon:function(t){var e=2*Math.PI;return function(i){for(var s=0;t>s;s++)i.forward(1),i.turn(e/t)}},spiral:function(t,e,i,s){return function(n){for(var o=0;e>o;o++)t(),n.forward(1),n.turn(i),n.resize(s)}},star:function(t){var e=4*Math.PI;return function(i){for(var s=0;t>s;s++)i.forward(1),i.turn(e/t)}},scale:function(t,e,i){return function(s){for(var n=0;e>n;n++)t(),s.resize(i)}}},layout:Tt,Effect:{spring:function(t){null==t&&(t={});var e=t.spring||.1,i=t.friction||.8,s=t.grivity||0,n=(t.wind,t.minLength||0);return{items:[],timer:null,isPause:!1,addNode:function(t,e){var i={node:t,target:e,vx:0,vy:0};return this.items.push(i),this},play:function(t){this.stop(),t=null==t?1e3/24:t;var e=this;this.timer=setInterval(function(){e.nextFrame()},t)},stop:function(){null!=this.timer&&window.clearInterval(this.timer)},nextFrame:function(){for(var t=0;t<this.items.length;t++){var o=this.items[t],h=o.node,r=o.target,a=o.vx,l=o.vy,u=r.x-h.x,c=r.y-h.y,d=Math.atan2(c,u);if(0!=n){var f=r.x-Math.cos(d)*n,p=r.y-Math.sin(d)*n;a+=(f-h.x)*e,l+=(p-h.y)*e}else a+=u*e,l+=c*e;a*=i,l*=i,l+=s,h.x+=a,h.y+=l,o.vx=a,o.vy=l}}}},gravity:function(t,e){var i=(e=e||{}).gravity||.1,s=e.dx||0,n=e.dy||5,o=e.stop;return new Lt(function(){o&&o()?(n=.5,this.stop()):(n+=i,t.setLocation(t.x+s,t.y+n))},e.interval||30)}},Animate:{stepByStep:function(t,e,i,s,n){var o=1e3/24,h={};for(var r in e){var a=e[r],l=a-t[r];h[r]={oldValue:t[r],targetValue:a,step:l/i*o,isDone:function(e){return this.step>0&&t[e]>=this.targetValue||this.step<0&&t[e]<=this.targetValue}}}return new Lt(function(){var i=!0;for(var o in e)h[o].isDone(o)||(t[o]+=h[o].step,i=!1);if(i){if(!s)return this.stop();for(var o in e)if(n){var r=h[o].targetValue;h[o].targetValue=h[o].oldValue,h[o].oldValue=r,h[o].step=-h[o].step}else t[o]=h[o].oldValue}return this},o)},rotate:function(t,e){var i=(e.context,null),s={},n=e.v;return s.run=function(){return i=setInterval(function(){return It?void s.stop():(t.rotate+=n||.2,void(t.rotate>2*Math.PI&&(t.rotate=0)))},100),s},s.stop=function(){return window.clearInterval(i),s.onStop&&s.onStop(t),s},s.onStop=function(t){return s.onStop=t,s},s},scale:function(t,e){function i(){r.onStop&&r.onStop(t),t.scaleX=o,t.scaleY=h,window.clearInterval(a)}var s=(e.position,e.context,e.scale||1),n=.06,o=t.scaleX,h=t.scaleY,r={},a=null;return r.onStop=function(t){return r.onStop=t,r},r.run=function(){return a=setInterval(function(){t.scaleX+=n,t.scaleY+=n,t.scaleX>=s&&i()},100),r},r.stop=i,r},move:function(t,e){function i(){window.clearInterval(h)}var s=e.position,n=(e.context,e.easing||.2),o={},h=null;return o.onStop=function(t){return o.onStop=t,o},o.run=function(){return h=setInterval(function(){if(It)o.stop();else{var e=s.x-t.x,h=s.y-t.y,r=e*n,a=h*n;t.x+=r,t.y+=a,r<.01&&a<.1&&i()}},100),o},o.stop=i,o},cycle:function(t,e){var i=e.p1,s=e.p2,n=(e.context,i.x+(s.x-i.x)/2),o=i.y+(s.y-i.y)/2,h=x.getDistance(i,s)/2,r=Math.atan2(o,n),a=e.speed||.2,l={},u=null;return l.run=function(){return u=setInterval(function(){if(It)l.stop();else{var e=i.y+n+Math.sin(r)*h;t.setLocation(t.x,e),r+=a}},100),l},l.stop=function(){window.clearInterval(u)},l},repeatThrow:function(t,e){function i(t){t.visible=!0,t.rotate=Math.random();var e=n.stage.canvas.width/2;t.x=e+Math.random()*(e-100)-Math.random()*(e-100),t.y=n.stage.canvas.height,t.vx=5*Math.random()-5*Math.random(),t.vy=-25}var s=.8,n=e.context,o=null,h={onStop:function(t){return h.onStop=t,h},run:function(){return i(t),o=setInterval(function(){return It?void h.stop():(t.vy+=s,t.x+=t.vx,t.y+=t.vy,void((t.x<0||t.x>n.stage.canvas.width||t.y>n.stage.canvas.height)&&(h.onStop&&h.onStop(t),i(t))))},50),h},stop:function(){window.clearInterval(o)}};return h},dividedTwoPiece:function(t,e){function i(e,i,s,n,o){var h=new JTopo.Node;return h.setImage(t.image),h.setSize(t.width,t.height),h.setLocation(e,i),h.showSelected=!1,h.dragable=!1,h.paint=function(t){t.save(),t.arc(0,0,s,n,o),t.clip(),t.beginPath(),null!=this.image?t.drawImage(this.image,-this.width/2,-this.height/2):(t.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")",t.rect(-this.width/2,-this.height/2,this.width/2,this.height/2),t.fill()),t.closePath(),t.restore()},h}var s=e.context,n=(t.style,{});return n.onStop=function(t){return n.onStop=t,n},n.run=function(){return function(e,s){var o=e,h=e+Math.PI,r=i(t.x,t.y,t.width,o,h),a=i(t.x-2+4*Math.random(),t.y,t.width,o+Math.PI,o);t.visible=!1,s.add(r),s.add(a),JTopo.Animate.gravity(r,{context:s,dx:.3}).run().onStop(function(){s.remove(r),s.remove(a),n.stop()}),JTopo.Animate.gravity(a,{context:s,dx:-.2}).run()}(e.angle,s),n},n.stop=function(){return n.onStop&&n.onStop(t),n},n},gravity:function(t,e){function i(){return window.clearInterval(o),h.onStop&&h.onStop(t),h}var s=e.context,n=e.gravity||.1,o=null,h={run:function(){var r=e.dx||0,a=e.dy||2;return o=setInterval(function(){return It?void h.stop():(a+=n,void(t.y+t.height<s.stage.canvas.height?t.setLocation(t.x+r,t.y+a):(a=0,i())))},20),h}};return h.stop=i,h.onStop=function(t){return h.onStop=t,h},h},startAll:function(){It=!1},stopAll:function(){It=!0}},util:x,createStageFromJson:function(t,e){var i=new JTopo.Stage(e);for(var s in t)"childs"!=s&&(i[s]=t[s]);return t.childs.forEach(function(t){var e=new JTopo.Scene(i);for(var s in t)"childs"!=s&&(e[s]=t[s]),"background"==s&&(e.background=t[s]);t.childs.forEach(function(t){var i=null,s=t.elementType;for(var n in"node"==s?i=new JTopo.Node:"CircleNode"==s&&(i=new JTopo.CircleNode),t)i[n]=t[n];e.add(i)})}),i}};!function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).CanvasRenderingContext2D;t.prototype.JTopoRoundRect=function(t,e,i,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;this.beginPath(),this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.quadraticCurveTo(t+i,e,t+i,e+n),this.lineTo(t+i,e+s-n),this.quadraticCurveTo(t+i,e+s,t+i-n,e+s),this.lineTo(t+n,e+s),this.quadraticCurveTo(t,e+s,t,e+s-n),this.lineTo(t,e+n),this.quadraticCurveTo(t,e,t+n,e),this.closePath()},t.prototype.JTopoDashedLineTo=function(t,e,i,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,o=i-t,h=s-e,r=Math.floor(Math.sqrt(o*o+h*h)),a=n<=0?r:r/n,l=h/r*n,u=o/r*n;this.beginPath();for(var c=0;a>c;c++)c%2?this.lineTo(t+c*u,e+c*l):this.moveTo(t+c*u,e+c*l);this.stroke()},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout(t,1e3/24)},window.console||(window.console={log:function(){},info:function(){},debug:function(){},warn:function(){},error:function(){}})}();e.default=At}]).default});